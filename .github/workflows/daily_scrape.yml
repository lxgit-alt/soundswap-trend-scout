name: SoundSwap Daily Blog Scout

on:
  schedule:
    - cron: '0 10  * * *'  # Daily at 10:00 UTC
  workflow_dispatch:  # Allows manual triggering

jobs:
  daily-blog-scout:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Trigger Daily Scout
        env:
          VERCEL_URL: ${{ secrets.VERCEL_URL }}
          CRON_SECRET: ${{ secrets.CRON_SECRET }}
        run: |
          echo "üöÄ Triggering daily scout job..."
          
          # Make request to your Vercel endpoint
          curl -X GET "$VERCEL_URL/api/scout" \
            -H "Authorization: Bearer $CRON_SECRET" \
            -H "Content-Type: application/json" \
            --max-time 30
          
          echo "‚úÖ Scout job triggered successfully"
          echo "The job will run asynchronously in Vercel Edge Functions"

      - name: Verify Health
        env:
          VERCEL_URL: ${{ secrets.VERCEL_URL }}
        run: |
          echo "üìä Checking service health..."
          curl -s "$VERCEL_URL/health" | jq .
          
          echo "üîç Checking recent logs (if available)..."
          # Add a small delay to allow scout job to start
          sleep 5
          curl -s "$VERCEL_URL/api/scout" || echo "Scout endpoint may be processing"

      - name: Notify Completion
        if: always()
        run: |
          echo "‚úÖ GitHub Actions workflow completed at $(date -u)"
          echo "The daily scout job has been triggered via Vercel Edge Functions"
          echo "Check your Discord channel for the daily topics report"